<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance SDK - 基础示例</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    #output {
      margin-top: 20px;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 5px;
    }
    pre {
      background: #fff;
      padding: 10px;
      border-radius: 3px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Performance SDK 示例</h1>
  
  <div>
    <button onclick="showMetrics()">查看性能指标</button>
    <button onclick="showResources()">查看资源信息</button>
    <button onclick="showErrors()">查看错误信息</button>
    <button onclick="triggerError()">触发错误</button>
    <button onclick="reportPerformance()">手动上报性能</button>
    <button onclick="highlightLCP()">高亮 LCP 元素</button>
    <button onclick="removeLCPHighlight()">移除高亮</button>
  </div>

  <div id="output"></div>

  <script type="module">
    // 假设 SDK 已经构建并可以通过相对路径引入
    // 实际使用时应该通过 npm 包引入
    import PerformanceHelper from '../dist/index.js';

    // 初始化 SDK
    const sdk = new PerformanceHelper({
      reportUrl: 'http://localhost:3006/api/report', // 本地服务器上报地址
      appId: 'demo-app',
      userId: 'demo-user',
      immediate: false,
      batchInterval: 5000,
    });

    // 将 sdk 挂载到 window 上，方便在按钮点击时使用
    window.sdk = sdk;

    // 初始化
    sdk.init();

    console.log('Performance SDK initialized');
  </script>

  <script>
    function showMetrics() {
      const metrics = window.sdk.getPerformanceMetrics();
      document.getElementById('output').innerHTML = `
        <h3>性能指标</h3>
        <pre>${JSON.stringify(metrics, null, 2)}</pre>
      `;
    }

    function showResources() {
      const resources = window.sdk.getResources();
      document.getElementById('output').innerHTML = `
        <h3>资源信息 (${resources.length} 个)</h3>
        <pre>${JSON.stringify(resources, null, 2)}</pre>
      `;
    }

    function showErrors() {
      const errors = window.sdk.getErrors();
      document.getElementById('output').innerHTML = `
        <h3>错误信息 (${errors.length} 个)</h3>
        <pre>${JSON.stringify(errors, null, 2)}</pre>
      `;
    }

    function triggerError() {
      try {
        throw new Error('这是一个测试错误');
      } catch (error) {
        window.sdk.reportError(error, { source: 'manual-test' });
        alert('错误已上报');
      }
    }

    function reportPerformance() {
      window.sdk.reportPerformance();
      alert('性能指标已上报');
    }

    function highlightLCP() {
      const success = window.sdk.highlightLCPElement({
        borderColor: '#ff0000',
        borderWidth: '3px',
        backgroundColor: 'rgba(255, 255, 0, 0.2)',
        scrollIntoView: true,
      });
      
      if (success) {
        document.getElementById('output').innerHTML = `
          <h3>LCP 元素已高亮</h3>
          <p>页面已自动滚动到 LCP 元素位置，元素周围已添加红色边框和黄色背景。</p>
          <p>点击"移除高亮"按钮可以移除高亮效果。</p>
        `;
      } else {
        document.getElementById('output').innerHTML = `
          <h3>无法高亮 LCP 元素</h3>
          <p>可能的原因：</p>
          <ul>
            <li>LCP 元素路径未找到</li>
            <li>页面尚未加载完成</li>
            <li>LCP 元素已被移除或修改</li>
          </ul>
          <p>请先点击"查看性能指标"按钮，确认是否有 lcpElement 数据。</p>
        `;
      }
    }

    function removeLCPHighlight() {
      window.sdk.removeLCPHighlight();
      document.getElementById('output').innerHTML = `
        <h3>LCP 元素高亮已移除</h3>
        <p>元素样式已恢复为原始状态。</p>
      `;
    }
  </script>
</body>
</html>

